# Developer Setup Guide

This guide walks you through setting up the VCF Tool development environment.

## Prerequisites

- **CMake** 3.15 or later
- **C++17 compatible compiler** (GCC 7+, Clang 5+, or MSVC 2017+)
- **Git** for version control

## Initial Setup

### 1. Clone the Repository

```bash
git clone <repository-url>
cd vcf-tool
```

### 2. Initialize Submodules

The project uses vcpkg as a git submodule for dependency management. Initialize it:

```bash
git submodule update --init --recursive
```

This will clone vcpkg into `external/vcpkg`.

### 3. Bootstrap vcpkg

Before first use, vcpkg must be bootstrapped:

```bash
./external/vcpkg/bootstrap-vcpkg.sh
```

On Windows, use `bootstrap-vcpkg.bat` instead.

## vcpkg Configuration

**Default vcpkg triplet**: `x64-linux` (x64 Linux, static linkage)

The project uses vcpkg to manage all third-party dependencies:
- **fmt** - Modern formatting library
- **spdlog** - Fast logging library
- **CLI11** - Command line parser
- **nlohmann-json** - JSON library
- **Catch2** - Testing framework

**Important**: Do NOT install these dependencies via system package managers (apt, yum, etc.).
All dependencies are managed through vcpkg and will be built automatically during CMake configuration.

## Building the Project

### Using CMake Presets (Recommended)

The project provides CMake presets for common configurations:

#### Debug Build
```bash
# Configure
cmake --preset linux-debug

# Build
cmake --build --preset linux-debug

# Run
./build/linux-debug/apps/vcf_tool/vcf_tool
```

#### Release Build
```bash
# Configure
cmake --preset linux-release

# Build
cmake --build --preset linux-release

# Run
./build/linux-release/apps/vcf_tool/vcf_tool
```

### Using Makefile Shortcuts

For convenience, you can use the root Makefile:

```bash
# Configure and build (Debug by default)
make config
make build

# Or configure for Release
make config-release
make build

# Run the application
make run

# Clean and rebuild from scratch
make rebuild
```

### Manual CMake Configuration

If you prefer manual configuration:

```bash
cmake -B build -S . \
  -DCMAKE_TOOLCHAIN_FILE=external/vcpkg/scripts/buildsystems/vcpkg.cmake \
  -DVCPKG_TARGET_TRIPLET=x64-linux \
  -DCMAKE_BUILD_TYPE=Debug

cmake --build build
```

## Running Tests

```bash
# Using presets
cmake --build --preset linux-debug
ctest --preset linux-debug

# Using Makefile
make test

# Manual
cd build && ctest --output-on-failure
```

## Project Architecture

### Module Dependency Rules

The project follows a strict layered architecture:

```
apps/vcf_tool/          # Application layer
    └─> src/domain/     # Domain models (NO third-party dependencies)
    └─> src/utils/      # Utility functions
    └─> src/core/       # Core abstractions (owns third-party integrations)
```

#### Important Constraints

1. **`src/domain/` must NOT depend on any third-party library**
   - Domain models should be pure C++ with no external dependencies
   - Business logic should be framework-agnostic

2. **`src/core/` owns all third-party integrations**
   - Logging (spdlog)
   - Formatting (fmt)
   - JSON parsing (nlohmann-json)
   - Provides abstractions for other modules to use

3. **`apps/*` own CLI parsing**
   - CLI11 is only used in application entry points
   - Not exposed to library modules

### Adding New Dependencies

To add a new vcpkg dependency:

1. Add it to `vcpkg.json` in the root directory
2. Reconfigure CMake (vcpkg will install it automatically)
3. Link the dependency in your `CMakeLists.txt`

**Remember**: Only add dependencies to `src/core/`, never to `src/domain/`.

## Build Options

The following CMake options are available:

- `BUILD_TESTS` (default: ON) - Build test suites
- `BUILD_DOCS` (default: OFF) - Build documentation
- `WARNINGS_AS_ERRORS` (default: ON) - Treat compiler warnings as errors
- `DEBUG` (default: OFF, auto-enabled in Debug builds) - Enable debug macros

Example:
```bash
cmake --preset linux-debug -DWARNINGS_AS_ERRORS=OFF
```

## Debug Macros

When building in Debug mode (or with `-DDEBUG=ON`), the following preprocessor macros are defined:

- `VCF_DEBUG` - Enable debug-only code paths
- `VCF_ENABLE_ASSERTS` - Enable assertion checks
- `VCF_PROFILE` - Enable performance profiling code

Use these to guard debug-specific code:

```cpp
#ifdef VCF_DEBUG
    std::cout << "Debug information..." << std::endl;
#endif
```

## IDE Support

### Visual Studio Code

The project includes `compile_commands.json` generation for better IntelliSense support.
This file is automatically generated in the build directory during CMake configuration.

### CLion

CLion should automatically detect the CMake presets and offer them in the configuration dropdown.

## Troubleshooting

### vcpkg fails to install dependencies

1. Ensure vcpkg is bootstrapped: `./external/vcpkg/bootstrap-vcpkg.sh`
2. Clear vcpkg cache: `rm -rf ~/.cache/vcpkg` or `rm -rf build/`
3. Try rebuilding: `make rebuild`

### Compiler warnings treated as errors

If you need to disable this temporarily:
```bash
cmake --preset linux-debug -DWARNINGS_AS_ERRORS=OFF
```

### Missing submodules

If `external/vcpkg` is empty:
```bash
git submodule update --init --recursive
```

## Next Steps

- Review the architecture documentation in `CLAUDE.md`
- Check out the main `README.md` for project overview
- Start developing! Add your code to the appropriate module following the dependency rules
